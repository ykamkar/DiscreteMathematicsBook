    \p
    ابتدا به بررسی حالت‌های نامطلوب جهت حذف کردن از تعداد حالات کلی، می‌پردازیم. در این مساله، حالت نامطلوب زمانی اتفاق می‌افتد که حداقل دسته‌ای وجود داشته باشد که اعداد روی هر سه توپ یکسان باشند. بنابراین روی تعداد دسته‌هایی که می‌توانند این ویژگی را داشته باشند حالت بندی می‌کنیم:
	\begin{enumerate}
	    \item 
    	اعداد روی هر سه توپ یک دسته, یکسان باشند که تعداد راه‌های دسته‌بندی به این صورت می‌شود:
    	$$\underbrace{{n  \choose 1}}_1\underbrace{(3n - 3)!}_2\underbrace{\frac{1}{(3!)^{n - 1}}}_3 \underbrace{\frac{1}{(n - 1)!}}_4$$
    	
    	- یک عدد را انتخاب می‌کنیم تا در یک دسته قرار بگیرند.
    	$(1)$
    	
    	- بقیه اعداد را در یک ردیف می‌چینیم.
    	$(2)$
    	
    	- و چون ترتیب اعداد درون دسته‌ها بی‌اهمیت است، باید تقسیم بر $(3!)^{n-1}$ کنیم.
    	(3)
    	
    	- از اول ردیف سه‌تا سه‌تا توپ‌ها را در یک دسته قرار می‌دهیم. در این صورت $n - 1$ دسته (غیر از دستهٔ اولی که جدا کردیم) داریم. ولی جایگشت این دسته‌ها برای ما اهمیتی ندارد بنابراین باید جواب را بر $(n-1)!$ تقسیم کنیم.
    	(4)
    	\item
    	اعداد روی هر سه توپ دو دسته, یکسان باشند که تعداد راه‌های دسته‌بندی مانند بالا خواهد بود و به این صورت می‌شود:
    	$${n  \choose 2}(3n - 6)! \frac{1}{(3!)^{n - 2}} \frac{1}{(n - 2)!}$$
    	\item
    	اعداد روی هر سه توپ $n$ دسته, یکسان باشند که تعداد راه‌های دسته بندی به این صورت می‌شود:
    	$${n \choose n}(3n - 3n)! \frac{1}{(3!)^{n - n}} \frac{1}{(n - n)!}$$
	\end{enumerate}
    \p
	از طرفی تعداد کل حالات به صورت زیر خواهد بود:
	
	$$\frac{1}{n!} \frac{(3n)!}{(3!)^n}$$
	
	در واقع برای محاسبه‌ی تعداد حالات کل، به این صورت که $3n$ توپ را در یک ردیف می‌چینیم و چون جایگشت دسته‌ها اهمیتی ندارد, تقسیم بر $n!$ می‌کنیم.
	
    \p
	بنابراین طبق اصل شمول و عدم شمول حالات مطلوب برابر خواهد بود با:
	$$\sum\limits_{i = 0}^n (-1)^i {n \choose i} \frac{1}{(n - i)!} \frac{(3n - 3i)!}{(3!)^{n - i}}$$
